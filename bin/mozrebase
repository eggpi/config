#!/bin/bash

if [ -n "$1" ]; then
    branches=$1
else
    branches=$(git branch | sed 's/\*//; s/^ *//')
fi

git fetch mozilla-central
oldbranch=$(git branch | sed -n 's/ *\*//p')

for b in $branches; do
    echo "Rebasing $b"
    git rebase mozilla-central/master $b

    if [ $? != 0 ]; then
        echo "Aborting rebase"
        git rebase --abort
        failed="$failed $b"
    fi
done

echo "Going back to start branch"
git checkout $oldbranch

if [ -n "$failed" ]; then
    echo "The following branches failed to be rebased:"
    for b in $failed; do
        echo $b
    done
fi
